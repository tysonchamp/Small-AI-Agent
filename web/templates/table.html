<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database: {{ table_name }} - AI Assistant</title> 
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #111827;
            --card-bg: #1f2937;
            --text-main: #f9fafb;
            --text-secondary: #9ca3af;
            --primary: #6366f1;
            --primary-hover: #818cf8;
            --border: #374151;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: var(--card-bg);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
        }

        .brand {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .menu-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            letter-spacing: 0.05em;
        }

        .nav-link {
            display: block;
            padding: 0.5rem 0.75rem;
            color: var(--text-main);
            text-decoration: none;
            border-radius: 0.375rem;
            margin-bottom: 0.25rem;
            font-size: 0.95rem;
            transition: background-color 0.2s;
        }

        .nav-link:hover {
            background-color: #374151;
            /* Darker hover */
        }

        .nav-link.active {
            background-color: #312e81;
            /* Dark indigo */
            color: #818cf8;
            font-weight: 500;
        }

        /* Main Content */
        .main {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
        }

        .card {
            background: var(--card-bg);
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* Table */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        th {
            text-align: left;
            padding: 0.75rem 1rem;
            background-color: #111827;
            /* Darker header */
            color: var(--text-secondary);
            font-weight: 600;
            border-bottom: 1px solid var(--border);
            white-space: nowrap;
        }

        td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        tr:last-child td {
            border-bottom: none;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-top: 1px solid var(--border);
        }

        .page-info {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .page-controls {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.375rem 0.75rem;
            border: 1px solid var(--border);
            background-color: var(--card-bg);
            border-radius: 0.375rem;
            color: var(--text-main);
            text-decoration: none;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .btn:hover {
            border-color: #6b7280;
            background-color: #374151;
        }

        .btn.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .back-link {
            text-decoration: none;
            color: var(--text-secondary);
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }

        .back-link:hover {
            color: var(--primary);
        }
    </style>
</head>

<body>
    <div class="sidebar">
        <a href="/dashboard" class="brand">ðŸ¤– AI Assistant</a>

        <div class="menu-label">Main</div>
        <a href="/dashboard" class="nav-link">Dashboard</a>
        <a href="/chat" class="nav-link">Chat</a>

        <div class="menu-label" style="margin-top: 1.5rem;">Database Tables</div>
        {% for table in tables %}
        <a href="/table/{{ table }}" class="nav-link {% if table == table_name %}active{% endif %}">
            ðŸ“„ {{ table }}
        </a>
        {% endfor %}
    </div>

    <div class="main">
        <div class="header">
            <h1>Table: {{ table_name }}</h1>
        </div>

        <div class="card">
            <!-- Search & Filter Controls -->
            <div
                style="padding: 1rem; border-bottom: 1px solid var(--border); display: flex; gap: 1rem; align-items: center;">
                <form method="GET" style="display: flex; gap: 0.5rem; flex: 1;">
                    <!-- Preserve existing filters/sort if any handled via hidden inputs? No, form submission resets unless we include them. 
                         For simplicity, global search resets other specialized filters usually, OR we keep them. 
                         Let's keep it simple: Search is global. Filters are separately updated via individual inputs or enter key.
                         Actually, standard pattern: A single form wrapping the table or separate form.
                         Easy way: Global Search form. Column filters form (on enter).
                         Let's just make the Search bar simply submit 'q'. -->
                    <input type="text" name="q" value="{{ q or '' }}" placeholder="Search all columns..."
                        style="background: #111827; border: 1px solid var(--border); color: white; padding: 0.5rem; border-radius: 0.375rem; flex: 1;">
                    <button type="submit" class="btn">Search</button>
                    {% if q or filters %}
                    <a href="?" class="btn" style="background: #ef4444; border-color: #ef4444;">Clear</a>
                    {% endif %}
                </form>
            </div>

            <div class="table-container">
                {% if rows %}
                <form method="GET" id="filterForm">
                    <!-- Preserve Global Search & Sort -->
                    {% if q %}<input type="hidden" name="q" value="{{ q }}">{% endif %}
                    {% if sort %}<input type="hidden" name="sort" value="{{ sort }}">{% endif %}
                    {% if order %}<input type="hidden" name="order" value="{{ order }}">{% endif %}

                    <table>
                        <thead>
                            <tr>
                                {% for col in columns %}
                                <th>
                                    <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                                        <!-- Sortable Header -->
                                        <a href="?sort={{ col }}&order={% if sort == col and order == 'ASC' %}DESC{% else %}ASC{% endif %}&q={{ q or '' }}{% for k, v in filters.items() %}&f_{{ k }}={{ v }}{% endfor %}"
                                            style="color: inherit; text-decoration: none; display: flex; align-items: center; gap: 0.25rem;">
                                            {{ col }}
                                            {% if sort == col %}
                                            <span>{% if order == 'ASC' %}â–²{% else %}â–¼{% endif %}</span>
                                            {% else %}
                                            <span style="opacity: 0.3;">â‡…</span>
                                            {% endif %}
                                        </a>
                                        <!-- Column Filter -->
                                        <input type="text" name="f_{{ col }}" value="{{ filters.get(col, '') }}"
                                            placeholder="Filter..."
                                            style="background: #374151; border: 1px solid var(--border); color: #d1d5db; padding: 0.25rem; border-radius: 0.25rem; font-size: 0.75rem; width: 100%; box-sizing: border-box;"
                                            onkeydown="if(event.key === 'Enter') document.getElementById('filterForm').submit()">
                                    </div>
                                </th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in rows %}
                            <tr>
                                {% for cell in row %}
                                <td title="{{ cell }}">{{ cell }}</td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <button type="submit" style="display: none;"></button> <!-- Allow implicit submit on enter -->
                </form>
                {% else %}
                <div style="padding: 3rem; text-align: center; color: var(--text-secondary);">
                    No data found matching your criteria.
                </div>
                {% endif %}
            </div>

            {% if total_pages > 1 %}
            <div class="pagination">
                <div class="page-info">
                    Page {{ page }} of {{ total_pages }}
                </div>
                <div class="page-controls">
                    <!-- Helper macro/logic to build query string for pagination -->
                    {% set base_query = 'q=' ~ (q or '') ~ '&sort=' ~ (sort or '') ~ '&order=' ~ (order or '') %}
                    {% for k, v in filters.items() %}
                    {% set base_query = base_query ~ '&f_' ~ k ~ '=' ~ v %}
                    {% endfor %}

                    <a href="?page={{ page - 1 }}&limit={{ limit }}&{{ base_query }}"
                        class="btn {% if page <= 1 %}disabled{% endif %}">Previous</a>
                    <a href="?page={{ page + 1 }}&limit={{ limit }}&{{ base_query }}"
                        class="btn {% if page >= total_pages %}disabled{% endif %}">Next</a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</body>

</html>